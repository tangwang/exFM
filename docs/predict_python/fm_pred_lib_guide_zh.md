# FM预测库 (fm_pred.so) Python指南

## 概述
FM预测库 (fm_pred.so) 是一个基于C的库，提供因子分解机模型的预测能力。本指南解释了如何在Python应用程序中使用该库。

## 库函数

该库暴露了以下主要函数：

1. `fmModelCreate`：创建一个新的FM模型实例
   - 输入：模型预测配置路径（字符串）
   - 返回：模型句柄（void指针）

2. `fmModelRelease`：释放FM模型实例
   - 输入：模型句柄
   - 返回：无

3. `fmPredictInstanceCreate`：为特定模型创建预测实例
   - 输入：模型句柄
   - 返回：预测实例句柄（void指针）

4. `fmPredictInstanceRelease`：释放预测实例
   - 输入：预测实例句柄
   - 返回：无

5. `fmPredictBatch`：执行批量预测
   - 输入：
     - 预测实例句柄
     - 特征字符串数组
     - 实例数量
     - 输出分数数组
     - 调试标志
   - 返回：状态码（0表示成功）

## 设置要求

1. fm_pred.so库必须在您的系统中可访问
2. Python ctypes库用于与C库接口
3. 正确的模型配置文件

## 线程安全

该库设计为线程安全：
- 一个FM模型可以在多个线程之间共享
- 每个线程应创建自己的预测实例
- 使用`threading.local()`进行线程局部存储预测实例

## 错误处理

该库在多个层面实现了错误检查：
- 库加载错误
- 模型创建错误
- 预测实例创建错误
- 批量预测错误

## 配置

模型需要一个配置文件（通常为JSON格式），指定：
- 模型参数
- 特征配置
- 其他与预测相关的设置

## 最佳实践

1. 始终正确释放资源
2. 每个线程创建一个预测实例
3. 使用批量预测以提高性能
4. 实现适当的错误处理
5. 记录重要操作和错误

请参见`fm_pred_example.py`中的示例代码以获取实际实现。 